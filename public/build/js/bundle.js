$(function(){function e(e,t,a){$(a+" .form-group label").css("color","inherit"),$(a+" .form-group label").css("color","#686868"),$.each(t,function(e,t){$(a+" .form-control[name='"+e+"']").prev("label").css("color","red")})}function t(e){$(".melis-toolcreator-steps-language-db-table-list li").removeClass("melis-toolcreator-disable-db-tbl-item"),void 0!==e&&$(".melis-toolcreator-steps-language-db-table-list li[data-table-name='"+e+"']").addClass("melis-toolcreator-disable-db-tbl-item"),$(".melis-toolcreator-steps-language-db-table-list li .fa").removeClass("fa-check-square-o").addClass("fa-square-o").removeClass("text-success"),$(".melis-toolcreator-steps-language-db-table-columns").html(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-tbl']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-pri-fk']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-lang-fk']").val(""),$(".melis-toolcreator-steps-table-list.melis-toolcreator-steps-language-db-table-list #loader").remove()}var a=$("body"),s='<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>';a.on("click",".melis-tool-creator .btn-steps",function(){var t=$(this).data("curstep"),a=$(this).data("nxtstep"),l=new Array,o=$(".melis-toolcreator-steps-content form.tool-creator-step-"+t),c="step-form";o.length>1&&(c="step-form[%s]"),o.each(function(e,t){var a=$(this).serializeArray();$.each(a,function(t,a){var s="";-1!=$.inArray(a.name,["tcf-db-table-cols","tcf-db-table-col-display","tcf-db-table-col-editable","tcf-db-table-col-required","tcf-db-table-col-type",""])&&(s="[]"),l.push({name:c.replace(/%s/g,e)+"["+a.name+"]"+s,value:a.value})})}),l.push({name:"curStep",value:t}),l.push({name:"nxtStep",value:a}),$(this).hasClass("tcf-validate")&&l.push({name:"validate",value:!0}),$("#id_melistoolcreator_steps").append(s),$.post("/melis/tool-creator-validate-cur-step",l).done(function(a){$("#id_melistoolcreator_steps #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){if(a.errors)melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors),e(0,a.errors,".tool-creator-step-"+t),$("#id_melistoolcreator_steps #loader").remove();else{$("#id_melistoolcreator_steps").html(a.html),$(".melis-toolcreator-steps li").removeClass("active");var s=$("#id_melistoolcreator_steps .steps-content").attr("id");$("#tc_"+s).addClass("active")}},500)}).error(function(e,t,a){alert(translations.tr_meliscore_error_message)})}),a.on("change","input[name='tcf-tool-type']",function(){$(".tcf-tool-type").hide(),$("#tcf-tool-type-"+$(this).val()).show()}),a.on("click",".tc-reload-dbtbl-cached",function(){$("#id_melistoolcreator_steps").append(s),$.post("/melis/tool-creator-validate-cur-step",{reloadDbTblCached:!0,curStep:2,nxtStep:3}).done(function(e){setTimeout(function(){$("#id_melistoolcreator_steps #loader").remove(),$("#id_melistoolcreator_steps").html(e)},500)})}),a.on("click",".melis-toolcreator-steps-table-tabs .widget-head a[data-toggle='tab']",function(){$(this).data("type")}),a.on("click",".melis-toolcreator-steps-table-list li",function(){if(!$(this).find(".fa").hasClass("fa-check-square-o")&&!$(this).hasClass("melis-toolcreator-disable-db-tbl-item")){var e=$(this).parent("ul").data("type"),a=".melis-toolcreator-steps-"+e+"-table-list";$(".melis-toolcreator-steps-table-list"+a+" li .fa").removeClass("fa-check-square-o").addClass("fa-square-o").removeClass("text-success"),$(this).find(".fa").addClass("fa-check-square-o"),$(this).find(".fa").removeClass("fa-square-o"),$(this).find(".fa").addClass("text-success"),$(".melis-toolcreator-steps-table-list"+a).append(s),$(".melis-toolcreator-steps-"+e+"-table-columns").append(s);var l="tcf-db-table";"primary-db"!==e&&(l="tcf-db-table-language-tbl"),$(".melis-toolcreator-steps-"+e+"-table-list input[name='"+l+"']").val($(this).data("table-name")),"primary-db"===e?($("#melistoolcreator_step3 .alert").hide("slow"),$(".melis-toolcreator-steps-table-list.melis-toolcreator-steps-language-db-table-list").append(s),""!==$.trim($(".melis-toolcreator-steps-language-db-table-columns").html())&&$(".melis-toolcreator-steps-language-db-table-columns").append(s)):$("#melistoolcreator_step3 .melis-toolcreator-steps-language-db-table-columns .alert").hide("slow");var o=$(this).data("table-name");$.post("/melis/tool-creator-get-tbl-cols",{tableName:o,type:e}).done(function(s){$(".melis-toolcreator-steps-table-list"+a+" #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),$(".melis-toolcreator-steps-"+e+"-table-columns #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$(".melis-toolcreator-steps-table-list"+a+" #loader").remove(),$(".melis-toolcreator-steps-"+e+"-table-columns").html(s.html),"primary-db"===e?t(o):($(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-pri-fk']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-lang-fk']").val(""))},500)})}}),a.on("click",".melis-toolcreator-steps-tbl-cols .tcf-fa-checkbox",function(){if($(this).hasClass("fa-check-square-o")){if($(this).hasClass("tcf-fa-checkall")?($(".tcf-fa-checkbox.tcf-fa-checkitem[data-col-type='"+$(this).data("col-type")+"'").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o").next("input").attr("checked",!1),$(this).hasClass("tfc-table-list")&&$("select[name='tcf-db-table-col-display'][data-col-type='"+$(this).data("col-type")+"']").attr("disabled",!0)):$(".tcf-fa-checkbox.tcf-fa-checkall[data-col-type='"+$(this).data("col-type")+"']").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$(this).addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o").next("input").attr("checked",!1),$(this).hasClass("tcf-fa-checkbox-editable")){var e=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']"),t=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']").prev();t.hasClass("fa-check-square-o")&&(t.addClass("fa-square-o"),t.removeClass("text-success"),t.removeClass("fa-check-square-o"),e.attr("checked",!1)),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!0)}$(this).hasClass("tfc-table-list")&&$(this).parents("tr").find("select[name='tcf-db-table-col-display']").attr("disabled",!0)}else{if($(this).hasClass("tcf-fa-checkall")&&($(".tcf-fa-checkbox.tcf-fa-checkitem[data-col-type='"+$(this).data("col-type")+"']").removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success").next("input").attr("checked",!0),$(this).hasClass("tfc-table-list")&&$("select[name='tcf-db-table-col-display'][data-col-type='"+$(this).data("col-type")+"']").attr("disabled",!1)),$(this).removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success").next("input").attr("checked",!0),$(".tcf-fa-checkbox.tcf-fa-checkitem").length===$(".tcf-fa-checkbox.tcf-fa-checkitem.fa-check-square-o").length&&$(".tcf-fa-checkbox.tcf-fa-checkall[data-col-type='"+$(this).data("col-type")+"']").removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success"),$(this).hasClass("tcf-fa-checkbox-required")){var a=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']"),s=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']").prev();s.hasClass("fa-square-o")&&(s.removeClass("fa-square-o"),s.addClass("fa-check-square-o"),s.addClass("text-success"),a.attr("checked",!0),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1))}$(this).hasClass("tcf-fa-checkbox-editable")&&$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1),$(this).hasClass("tfc-table-list")&&$(this).parents("tr").find("select[name='tcf-db-table-col-display']").attr("disabled",!1)}}),a.on("click",".melis-tc-tool-language.fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(".melis-tc-tool-language-db-list").hide(1e3,"linear",function(){$("#tool-creator-step-3 input[name='tcf-db-table-has-language']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-tbl']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-pri-fk']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-lang-fk']").val("")})):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(".melis-tc-tool-language-db-list").show(1e3,"linear",function(){$("#tool-creator-step-3 input[name='tcf-db-table-has-language']").val(1)}))}),a.on("click",".melis-tc-lang-tbl-pt-fk.fa, .melis-tc-lang-tbl-lt-fk.fa",function(){if($(this).hasClass("fa-check-square-o"))$(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$("#tool-creator-step-3 input[name='"+$(this).data("field-name")+"']").val("");else{if($(this).hasClass("melis-tc-lang-tbl-pt-fk")){$(".melis-tc-lang-tbl-pt-fk.fa").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o");var e=$(".melis-tc-lang-tbl-lt-fk.fa[data-tbl-name='"+$(this).data("tbl-name")+"']");e.addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$ptFkInpt=$("#tool-creator-step-3 input[name='"+e.data("field-name")+"']"),$ptFkInpt.val()===$(this).data("tbl-name")&&$ptFkInpt.val("")}else{$(".melis-tc-lang-tbl-lt-fk.fa").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o");var t=$(".melis-tc-lang-tbl-pt-fk.fa[data-tbl-name='"+$(this).data("tbl-name")+"']");t.addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$ptFkInpt=$("#tool-creator-step-3 input[name='"+t.data("field-name")+"']"),$ptFkInpt.val()===$(this).data("tbl-name")&&$ptFkInpt.val("")}$("#tool-creator-step-3 input[name='"+$(this).data("field-name")+"']").val($(this).data("tbl-name")),$(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success")}}),a.on("click",".melis-tc-final-content .fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1)):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0))}),a.on("click",".tc-final-step",function(){var e=!1;$(".melis-tc-final-content .fa").hasClass("fa-check-square-o")&&(e=!0),$.get("/melis/MelisToolCreator/ToolCreator/finalize",{activateModule:e}).done(function(e){$(".melis-tc-final-content").hide(),$(".melis-tc-final-content").hide()}).fail(function(){})})});