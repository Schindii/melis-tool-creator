$(function(){var e=$("body"),t='<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>';e.on("click",".melis-tool-creator .btn-steps",function(){var e=$(this).data("curstep"),s=$(this).data("nxtstep"),a=new Array,c=$(".melis-toolcreator-steps-content form.tool-creator-step-"+e),l="step-form";c.length>1&&(l="step-form[%s]"),c.each(function(e,t){var s=$(this).serializeArray();$.each(s,function(t,s){var c="";-1!=$.inArray(s.name,["tcf-db-table-cols","tcf-db-table-col-editable","tcf-db-table-col-required","tcf-db-table-col-type"])&&(c="[]"),a.push({name:l.replace(/%s/g,e)+"["+s.name+"]"+c,value:s.value})})}),a.push({name:"curStep",value:e}),a.push({name:"nxtStep",value:s}),$(this).hasClass("tcf-validate")&&a.push({name:"validate",value:!0}),$("#id_melistoolcreator_steps").append(t),$.post("/melis/tool-creator-validate-cur-step",a).done(function(t){$("#id_melistoolcreator_steps #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){if(t.errors)melisHelper.melisMultiKoNotification(t.textTitle,t.textMessage,t.errors),melisHelper.highlightMultiErrors(0,t.errors,".tool-creator-step-"+e),$("#id_melistoolcreator_steps #loader").remove();else{$("#id_melistoolcreator_steps").html(t.html),$(".melis-toolcreator-steps li").removeClass("active");var s=$("#id_melistoolcreator_steps .steps-content").attr("id");$("#tc_"+s).addClass("active")}},500)}).error(function(e,t,s){alert(e.responseText)})}),e.on("click",".tc-reload-dbtbl-cached",function(){var e=$(this);e.attr("disabled",!0),$(".melis-toolcreator-steps-table-list").append(t),$.post("/melis/tool-creator-reload-dbtbl-cached",{reloadDbTblCached:!0,selectedTbl:$(".melis-toolcreator-steps-table-list input[name='tcf-db-table']").val()}).done(function(t){e.attr("disabled",!1),$(".melis-toolcreator-steps-table-list #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$(".melis-toolcreator-steps-table-list #loader").remove(),$(".melis-toolcreator-steps-table-list").html(t.html)},500)})}),e.on("click",".melis-toolcreator-steps-table-list li",function(){$(".melis-toolcreator-steps-table-list li .fa").removeClass("fa-check-square-o"),$(".melis-toolcreator-steps-table-list li .fa").addClass("fa-square-o"),$(".melis-toolcreator-steps-table-list li .fa").removeClass("text-success"),$(this).find(".fa").addClass("fa-check-square-o"),$(this).find(".fa").removeClass("fa-square-o"),$(this).find(".fa").addClass("text-success"),$(".melis-toolcreator-steps-table-list").append(t),$(".melis-toolcreator-steps-table-columns").parent().removeClass("hidden"),$(".melis-toolcreator-steps-table-columns").append(t),$(".melis-toolcreator-steps-table-list input[name='tcf-db-table']").val($(this).data("table-name")),$("#melistoolcreator_step3 .alert").hide("slow"),$.post("/melis/tool-creator-get-tbl-cols",{tableName:$(this).data("table-name")}).done(function(e){$(".melis-toolcreator-steps-table-list #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),$(".melis-toolcreator-steps-table-columns #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$(".melis-toolcreator-steps-table-list #loader").remove(),$(".melis-toolcreator-steps-table-columns").html(e.html)},500)})}),e.on("click",".melis-toolcreator-steps-tbl-cols .tcf-fa-checkbox",function(){if($(this).hasClass("fa-check-square-o")){if($(this).hasClass("tcf-fa-checkall")?($(".tcf-fa-checkbox.tcf-fa-checkitem").addClass("fa-square-o"),$(".tcf-fa-checkbox.tcf-fa-checkitem").removeClass("text-success"),$(".tcf-fa-checkbox.tcf-fa-checkitem").removeClass("fa-check-square-o"),$(".tcf-fa-checkbox.tcf-fa-checkitem").next("input").attr("checked",!1)):($(".tcf-fa-checkbox.tcf-fa-checkall").addClass("fa-square-o"),$(".tcf-fa-checkbox.tcf-fa-checkall").removeClass("text-success"),$(".tcf-fa-checkbox.tcf-fa-checkall").removeClass("fa-check-square-o")),$(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1),($(this).hasClass("tcf-fa-checkbox-editable")||$(this).hasClass("tcf-fa-checkbox-required"))&&console.log($(this).attr("class")),$(this).hasClass("tcf-fa-checkbox-editable")){var e=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']"),t=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']").prev();t.hasClass("fa-check-square-o")&&(t.addClass("fa-square-o"),t.removeClass("text-success"),t.removeClass("fa-check-square-o"),e.attr("checked",!1)),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!0)}}else{if($(this).hasClass("tcf-fa-checkall")&&($(".tcf-fa-checkbox.tcf-fa-checkitem").removeClass("fa-square-o"),$(".tcf-fa-checkbox.tcf-fa-checkitem").addClass("fa-check-square-o"),$(".tcf-fa-checkbox.tcf-fa-checkitem").addClass("text-success"),$(".tcf-fa-checkbox.tcf-fa-checkitem").next("input").attr("checked",!0)),$(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0),$(".tcf-fa-checkbox.tcf-fa-checkitem").length==$(".tcf-fa-checkbox.tcf-fa-checkitem.fa-check-square-o").length&&$(".tcf-fa-checkbox.tcf-fa-checkall").removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success"),$(this).hasClass("tcf-fa-checkbox-required")){var s=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']"),a=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']").prev();a.hasClass("fa-square-o")&&(a.removeClass("fa-square-o"),a.addClass("fa-check-square-o"),a.addClass("text-success"),s.attr("checked",!0),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1))}$(this).hasClass("tcf-fa-checkbox-editable")&&$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1)}}),e.on("click",".melis-tc-final-content .fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1)):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0))}),e.on("click",".tc-final-step",function(){var e=!1;$(".melis-tc-final-content .fa").hasClass("fa-check-square-o")&&(e=!0),$.get("/melis/MelisToolCreator/ToolCreator/finalize",{activateModule:e}).done(function(e){$(".melis-tc-final-content").hide(),$(".melis-tc-final-content").hide()}).fail(function(){})})});