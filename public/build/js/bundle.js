$(function(){function e(e,a,t){$(t+" .form-group label").css("color","inherit"),$(t+" .form-group label").css("color","#686868"),$.each(a,function(e,a){$(t+" .form-control[name='"+e+"']").prev("label").css("color","red")})}function a(e){$(".melis-toolcreator-steps-language-db-table-list li").removeClass("melis-toolcreator-disable-db-tbl-item"),void 0!==e&&$(".melis-toolcreator-steps-language-db-table-list li[data-table-name='"+e+"']").addClass("melis-toolcreator-disable-db-tbl-item"),$(".melis-toolcreator-steps-language-db-table-list li .fa").removeClass("fa-check-square-o").addClass("fa-square-o").removeClass("text-success"),$(".melis-toolcreator-steps-language-db-table-columns").html(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-tbl']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-pri-fk']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-lang-fk']").val(""),$(".melis-toolcreator-steps-table-list.melis-toolcreator-steps-language-db-table-list #loader").remove()}var t=$("body"),s='<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>';t.on("click",".melis-tool-creator .btn-steps",function(){var a=$(this).data("curstep"),t=$(this).data("nxtstep"),l=new Array,o=$(".melis-toolcreator-steps-content form.tool-creator-step-"+a),c="step-form";o.length>1&&(c="step-form[%s]"),o.each(function(e,a){var t=$(this).serializeArray();$.each(t,function(a,t){var s="";-1!=$.inArray(t.name,["tcf-db-table-cols","tcf-db-table-col-editable","tcf-db-table-col-required","tcf-db-table-col-type",""])&&(s="[]"),l.push({name:c.replace(/%s/g,e)+"["+t.name+"]"+s,value:t.value})})}),l.push({name:"curStep",value:a}),l.push({name:"nxtStep",value:t}),$(this).hasClass("tcf-validate")&&l.push({name:"validate",value:!0}),$("#id_melistoolcreator_steps").append(s),$.post("/melis/tool-creator-validate-cur-step",l).done(function(t){$("#id_melistoolcreator_steps #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){if(t.errors)melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),e(0,t.errors,".tool-creator-step-"+a),$("#id_melistoolcreator_steps #loader").remove();else{$("#id_melistoolcreator_steps").html(t.html),$(".melis-toolcreator-steps li").removeClass("active");var s=$("#id_melistoolcreator_steps .steps-content").attr("id");$("#tc_"+s).addClass("active")}},500)}).error(function(e,a,t){alert(translations.tr_meliscore_error_message)})}),t.on("click",".tc-reload-dbtbl-cached",function(){var e=$(this);e.attr("disabled",!0),$(".melis-toolcreator-steps-table-list").append(s),$.post("/melis/tool-creator-reload-dbtbl-cached",{reloadDbTblCached:!0,selectedTbl:$(".melis-toolcreator-steps-table-list input[name='tcf-db-table']").val()}).done(function(a){e.attr("disabled",!1),$(".melis-toolcreator-steps-table-list #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$(".melis-toolcreator-steps-table-list #loader").remove(),$(".melis-toolcreator-steps-table-list").html(a.html)},500)})}),t.on("click",".melis-toolcreator-steps-table-tabs .widget-head a[data-toggle='tab']",function(){var e=$(this).data("type");console.log(e)}),t.on("click",".melis-toolcreator-steps-table-list li",function(){if(!$(this).find(".fa").hasClass("fa-check-square-o")&&!$(this).hasClass("melis-toolcreator-disable-db-tbl-item")){var e=$(this).parent("ul").data("type"),t=".melis-toolcreator-steps-"+e+"-table-list";$(".melis-toolcreator-steps-table-list"+t+" li .fa").removeClass("fa-check-square-o").addClass("fa-square-o").removeClass("text-success"),$(this).find(".fa").addClass("fa-check-square-o"),$(this).find(".fa").removeClass("fa-square-o"),$(this).find(".fa").addClass("text-success"),$(".melis-toolcreator-steps-table-list"+t).append(s),$(".melis-toolcreator-steps-"+e+"-table-columns").append(s);var l="tcf-db-table";"primary-db"!==e&&(l="tcf-db-table-language-tbl"),$(".melis-toolcreator-steps-"+e+"-table-list input[name='"+l+"']").val($(this).data("table-name")),"primary-db"===e?($("#melistoolcreator_step3 .alert").hide("slow"),$(".melis-toolcreator-steps-table-list.melis-toolcreator-steps-language-db-table-list").append(s),""!==$.trim($(".melis-toolcreator-steps-language-db-table-columns").html())&&$(".melis-toolcreator-steps-language-db-table-columns").append(s)):$("#melistoolcreator_step3 .melis-toolcreator-steps-language-db-table-columns .alert").hide("slow");var o=$(this).data("table-name");$.post("/melis/tool-creator-get-tbl-cols",{tableName:o,type:e}).done(function(s){$(".melis-toolcreator-steps-table-list"+t+" #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),$(".melis-toolcreator-steps-"+e+"-table-columns #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$(".melis-toolcreator-steps-table-list"+t+" #loader").remove(),$(".melis-toolcreator-steps-"+e+"-table-columns").html(s.html),"primary-db"===e?a(o):($(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-pri-fk']").val(""),$(".melis-toolcreator-steps-language-db-table-list input[name='tcf-db-table-language-lang-fk']").val(""))},500)})}}),t.on("click",".melis-toolcreator-steps-tbl-cols .tcf-fa-checkbox",function(){if($(this).hasClass("fa-check-square-o")){if($(this).hasClass("tcf-fa-checkall")?$(".tcf-fa-checkbox.tcf-fa-checkitem[data-col-type='"+$(this).data("col-type")+"'").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o").next("input").attr("checked",!1):$(".tcf-fa-checkbox.tcf-fa-checkall[data-col-type='"+$(this).data("col-type")+"'").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$(this).addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o").next("input").attr("checked",!1),($(this).hasClass("tcf-fa-checkbox-editable")||$(this).hasClass("tcf-fa-checkbox-required"))&&console.log($(this).attr("class")),$(this).hasClass("tcf-fa-checkbox-editable")){var e=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']"),a=$("input[name='tcf-db-table-col-required'][value='"+$(this).next("input").val()+"']").prev();a.hasClass("fa-check-square-o")&&(a.addClass("fa-square-o"),a.removeClass("text-success"),a.removeClass("fa-check-square-o"),e.attr("checked",!1)),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!0)}}else{if($(this).hasClass("tcf-fa-checkall")&&$(".tcf-fa-checkbox.tcf-fa-checkitem[data-col-type='"+$(this).data("col-type")+"'").removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success").next("input").attr("checked",!0),$(this).removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success").next("input").attr("checked",!0),$(".tcf-fa-checkbox.tcf-fa-checkitem").length===$(".tcf-fa-checkbox.tcf-fa-checkitem.fa-check-square-o").length&&$(".tcf-fa-checkbox.tcf-fa-checkall[data-col-type='"+$(this).data("col-type")+"'").removeClass("fa-square-o").addClass("fa-check-square-o").addClass("text-success"),$(this).hasClass("tcf-fa-checkbox-required")){var t=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']"),s=$("input[name='tcf-db-table-col-editable'][value='"+$(this).next("input").val()+"']").prev();s.hasClass("fa-square-o")&&(s.removeClass("fa-square-o"),s.addClass("fa-check-square-o"),s.addClass("text-success"),t.attr("checked",!0),$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1))}$(this).hasClass("tcf-fa-checkbox-editable")&&$(this).parents("tr").find("select[name='tcf-db-table-col-type']").attr("disabled",!1)}}),t.on("click",".melis-tc-tool-language.fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(".melis-tc-tool-language-db-list").hide(1e3,"linear",function(){$("#tool-creator-step-3 input[name='tcf-db-table-has-language']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-tbl']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-pri-fk']").val(""),$("#tool-creator-step-3 input[name='tcf-db-table-language-lang-fk']").val("")})):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(".melis-tc-tool-language-db-list").show(1e3,"linear",function(){$("#tool-creator-step-3 input[name='tcf-db-table-has-language']").val(1)}))}),t.on("click",".melis-tc-lang-tbl-pt-fk.fa, .melis-tc-lang-tbl-lt-fk.fa",function(){if($(this).hasClass("fa-check-square-o"))$(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$("#tool-creator-step-3 input[name='"+$(this).data("field-name")+"']").val("");else{if($(this).hasClass("melis-tc-lang-tbl-pt-fk")){$(".melis-tc-lang-tbl-pt-fk.fa").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o");var e=$(".melis-tc-lang-tbl-lt-fk.fa[data-tbl-name='"+$(this).data("tbl-name")+"']");e.addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$ptFkInpt=$("#tool-creator-step-3 input[name='"+e.data("field-name")+"']"),$ptFkInpt.val()===$(this).data("tbl-name")&&$ptFkInpt.val("")}else{$(".melis-tc-lang-tbl-lt-fk.fa").addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o");var a=$(".melis-tc-lang-tbl-pt-fk.fa[data-tbl-name='"+$(this).data("tbl-name")+"']");a.addClass("fa-square-o").removeClass("text-success").removeClass("fa-check-square-o"),$ptFkInpt=$("#tool-creator-step-3 input[name='"+a.data("field-name")+"']"),$ptFkInpt.val()===$(this).data("tbl-name")&&$ptFkInpt.val("")}$("#tool-creator-step-3 input[name='"+$(this).data("field-name")+"']").val($(this).data("tbl-name")),$(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success")}}),t.on("click",".melis-tc-final-content .fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1)):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0))}),t.on("click",".tc-final-step",function(){var e=!1;$(".melis-tc-final-content .fa").hasClass("fa-check-square-o")&&(e=!0),$.get("/melis/MelisToolCreator/ToolCreator/finalize",{activateModule:e}).done(function(e){$(".melis-tc-final-content").hide(),$(".melis-tc-final-content").hide()}).fail(function(){})})});